#!/bin/bash

# File path for conservation_mode
CONSERVATION_MODE_PATH="/sys/bus/platform/drivers/ideapad_acpi/VPC2004:00/conservation_mode"

# Function to display help
show_help() {
    echo "Usage: batcut [OPTION] [VALUE]"
    echo
    echo "Options:"
    echo "  0          Disable conservation mode (allow full battery charge)"
    echo "  1          Enable conservation mode (limit battery to 60% charge)"
    echo "  -h, --help Display this help message"
    echo
    echo "Examples:"
    echo "  batcut 1   Enable conservation mode"
    echo "  batcut 0   Disable conservation mode"
}

# Check for arguments
if [[ $# -eq 0 ]]; then
    echo "Error: No arguments provided. Use -h or --help for usage information."
    exit 1
fi

# Handle help option
if [[ "$1" == "-h" || "$1" == "--help" ]]; then
    show_help
    exit 0
fi

# Handle conservation mode setting
if [[ "$1" == "1" ]]; then
    echo 1 | sudo tee "$CONSERVATION_MODE_PATH" > /dev/null
    echo "Conservation mode enabled."
elif [[ "$1" == "0" ]]; then
    echo 0 | sudo tee "$CONSERVATION_MODE_PATH" > /dev/null
    echo "Conservation mode disabled."
else
    echo "Error: Invalid argument '$1'. Use -h or --help for usage information."
    exit 1
fi
